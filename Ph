-- Initialize mod namespace to avoid conflicts
local mod_id = "ChaosCarver"
SMODS.Mods[mod_id] = SMODS.Mods[mod_id] or { ID = mod_id }

-- Define the Chaos Carver Joker
SMODS.Joker {
    key = "chaos_carver",
    loc_txt = {
        name = "Chaos Carver",
        text = {
            "When scoring a hand with {C:attention}exactly 1 card{},",
            "that card gains a random {C:attention}enhancement{},",
            "{C:attention}seal{}, and {C:attention}edition{}"
        }
    },
    config = {}, -- No extra variables needed
    rarity = 2, -- Uncommon (1=Common, 2=Uncommon, 3=Rare, 4=Legendary)
    cost = 6, -- Balanced cost for situational power
    unlocked = true,
    discovered = true,
    blueprint_compat = true, -- Compatible with Blueprint
    eternal_compat = true,
    atlas = "joker_sprites", -- Optional sprite sheet
    pos = { x = 0, y = 0 }, -- Update with sprite coordinates
    calculate = function(self, card, context)
        -- Debug log
        print("[" .. mod_id .. "] Chaos Carver calculate called")
        -- Check if scoring a hand with exactly 1 card
        if context.scoring and #context.scoring_hand == 1 and not context.blueprint then
            local scored_card = context.scoring_hand[1]
            if scored_card then
                -- Debug log
                print("[" .. mod_id .. "] Single card detected: " .. scored_card.config.center.key)
                -- Add random enhancement
                local enhancement_pool = { "bonus", "mult", "wild", "glass", "stone", "steel", "gold" }
                local random_enhancement = pseudorandom_element(enhancement_pool, pseudoseed("chaos_enhancement"))
                scored_card:set_ability(G.P_CENTERS["m_" .. random_enhancement], true)
                print("[" .. mod_id .. "] Added enhancement: " .. random_enhancement)
                
                -- Add random seal
                local seal_pool = { "gold", "red", "blue", "purple" }
                local random_seal = pseudorandom_element(seal_pool, pseudoseed("chaos_seal"))
                scored_card:set_seal(random_seal, true)
                print("[" .. mod_id .. "] Added seal: " .. random_seal)
                
                -- Add random edition
                local edition_pool = { "foil", "holo", "polychrome", "negative" }
                local random_edition = pseudorandom_element(edition_pool, pseudoseed("chaos_edition"))
                scored_card:set_edition({ [random_edition] = true }, true)
                print("[" .. mod_id .. "] Added edition: " .. random_edition)
                
                -- Show notification
                return {
                    message = "Chaos Carved!",
                    card = card,
                    colour = G.C.PURPLE
                }
            end
        end
    end
}
